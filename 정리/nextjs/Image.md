# Next.js에서의 Image

## 무엇을 해결할 수 있는가
1. **이미지 최적화**  
   300x300 크기의 이미지가 있고, 작은 화면의 디바이스에서는 100x100 크기의 이미지가 필요하다고 가정해 봅시다. 300x300 크기의 이미지를 불러오면 어떤 문제가 발생할까요?

   ### 문제
   - **네트워크 대역폭**:  
     이미지의 크기가 클수록 네트워크 대역폭 사용량이 증가합니다. 따라서 필요 이상으로 큰 이미지를 불러오면 네트워크 대역폭을 과도하게 사용하게 됩니다.
   
   - **데이터 사용량**:  
     모바일 사용자의 경우, 큰 이미지는 데이터 플랜에 영향을 줄 수 있습니다.
     
   - **메모리 사용**:  
     큰 이미지는 더 많은 메모리를 사용할 수 있으며, 특히 메모리가 제한된 장치에서는 성능 저하를 일으킬 수 있습니다.
     
   - **LCP 지표 하락**:  
     Largest Contentful Paint (LCP)는 사용자의 실제 경험을 반영하는 웹 성능의 주요 지표입니다. 페이지가 로드되는 동안 가장 큰 컨텐츠 요소가 사용자의 화면에 나타나기까지 걸린 시간을 나타냅니다. 큰 이미지는 LCP 지표를 하락시킬 수 있습니다.
     
  ### 해결  
  - **이미지 포맷과 압축**:  
    현대적인 이미지 포맷(예: WebP, AVIF)과 압축 기법을 사용하여 이미지 크기를 줄이면, 품질을 크게 손상시키지 않으면서도 대역폭 사용을 줄일 수 있습니다. Next.js에서는 이미지 포맷팅을 지원합니다. 사용법은 다음과 같습니다.
    ```typescript
    // next.config.js
    module.exports = {
     images: {
        formats: ['image/avif', 'image/webp'],
     },
    }
    ```
    AVIF는 Edge에서는 아직 지원하지 않는 포맷입니다. 브라우저가 AVIF를 지원하지 않는 경우, Next.js의 이미지 최적화 기능은 자동으로 브라우저가 지원하는 다른 형식인 WebP를 사용하려고 시도합니다. 이는 브라우저의 `Accept` 헤더를 확인하여 이루어집니다. 브라우저가 어떤 이미지 포맷을 지원하는지 나타내는 `Accept` 헤더에 따라, Next.js는 적절한 포맷의 이미지를 제공합니다.
    
  - **Resolution Switching**:  
    사용자의 디바이스와 화면 크기에 따라 다른 사이즈의 이미지를 제공하는 기법입니다. 이는 불필요한 데이터 전송을 줄이고 로딩 시간을 단축시킵니다. Next.js에서는 `srcSet`과 `sizes` 속성을 관리하여 다양한 해상도의 이미지를 생성하고 적절한 이미지를 로드합니다. 사용자 정의 설정이 필요한 경우, 다음과 같은 config 옵션을 수정할 수 있습니다.

    ```typescript
    module.exports = {
     images: {
       imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],
       deviceSizes: [640, 750, 828, 1080, 1200, 1920, 2048, 3840],
     },
    };
    ```
    `sizes` 속성은 반응형 이미지를 위해 사용되며, 해상도별로 적절한 이미지를 로드할 수 있게 합니다. 기본값이 100vh로 설정되어 있으므로, 이를 고려하지 않으면 큰 이미지가 로드될 수 있습니다.

    ```typescript
    import Image from 'next/image'
 
    export default function Page() {
     return (
       <div className="grid-element">
         <Image
           fill
           src="/example.png"
           sizes="(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"
         />
       </div>
     )
    }
    ```

2. **Layout Shift 방지**:  
   Layout Shift는 이미지 로딩, 폰트 변경, 동적 컨텐츠 삽입으로 인한 DOM의 변화로 발생할 수 있습니다. 이러한 변화는 성능 이슈를 유발하고 사용자 경험을 저하시킬 수 있습니다.
   Layout Shift를 방지하는 방법은 미리 그려질 요소에 대한 크기를 정하는 것입니다. 예를 들어, 동적으로 추가될 이미지의 크기를 미리 지정하면,
   이미지 로딩에 의한 레이아웃 변경을 방지할 수 있습니다. Next.js의 Image 컴포넌트 에서는 `width`와 `height`를 필수 속성으로 가집니다.
   ```typescript
   import Image from 'next/image'
    
    export default function Page() {
    return (
      <Image
        src="/path/to/image"
        alt="Picture of the author"
        width={500}
        height={500}
      />
      )
    }
   ```

   만약 이미지의 사이즈를 미리 알 수 없는 경우, 다음과 같은 선택지가 있습니다:
   
   - **fill prop 사용**: `fill` 속성을 사용하면 Image 컴포넌트는 부모 요소의 크기에 맞추게 됩니다. 단, 이 경우 `width`와 `height` 속성을 함께 사용할 수 없습니다.
   - **미리 서버에서 이미지 사이즈 조절**: 서버 측에서 이미지의 크기를 조절하여 저장합니다.
   - **API 요청 시 사이즈 지정**: 서버 API를 수정하여 요청 시 이미지의 사이즈를 지정할 수 있도록 합니다.

