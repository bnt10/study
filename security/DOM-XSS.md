# DOM 기반 크로스 사이트 스크립팅 공격(DOM-XSS)

## DOM Based XSS

대부분의 XSS을 막는 방법은 Server측 코드에서 검사하고 보호하면 해결됩니다.  
그러나 DOM 기반 크로스 사이트 스크립팅 공격은 Client의 취약점을 이용합니다.  

DOM 기반 XSS 공격은 보안에 취약한 JavaScript 코드로 DOM 객체를 제어하는 과정에서 발생합니다.  
이 공격에 대해서 이해하려면 먼저 URL이 동작하는 방식을 이해해야 합니다.  

<img width="407" alt="image" src="https://user-images.githubusercontent.com/43377349/211181286-6d0e87e4-323f-4095-8fd4-1a70dfbf0910.png">

위의 URI 조각은 # 기호 뒤에 있는 URL의 선택적 부분입니다. 
요즘 React와 같은 단일 페이지 애플리케이션은 브라우저가 새로 고쳐지더라도  URI 조각을 이용해 브라우저 업데이트/교체 상태를 유지함으로써 렌더링 블랭크를 방지하는 등 
**서버에 전송하지 않고 URI 조각을 사용할 수 있습니다.**


## 공격 시나리오  

1. 악의적인 사용자가 보안이 취약한 웹 페이지를 발견했습니다.
2. 악성 스크립트가 실행되도록 URL 주소를 만들어 일반 사용자에게 전달합니다.(메일)
3. 일반 사용자는 메일 등을 통해 전달받은 URL 링크를 클릭합니다. 서버로부터 HTML 문서를 전달받습니다.
4. 사용자의 브라우저가 응답 받은 HTML 문서를 읽으면서 필요한 스크립트를 실행하는 중에 악성 스크립트가 동작합니다.
5. 악성 스크립트를 통해 사용자 정보가 악의적으로 전달됩니다.


## 공격에 의해 노출되는 위험
1. 피해자의 브라우저에 악성 코드 주입 및 실행 가능  
2. 악성 사이트로 리다이렉트 처리 가능(피싱)  
3. 피해자의 인증 정보(쿠키 등) 탈취 가능  

## 방지방법
서버측 코드와 마찬가지로 HTML의 값을 클라언트 측 코드로 삽입하기 전에 URI 조각에서 가져온 모든 값을 
이스케이프 해야합니다. 리엑트 프레임 워크에서는 이부분을 자동으로 이스케이프 합니다.  
이를 무시하기 위해서는 `dangerouslySetInnerHTMML`을 이용해야 한다.
